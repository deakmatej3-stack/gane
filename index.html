<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNAKE NEON: EVOLVED</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');

        :root {
            --neon: #00ff41;
            --accent: #ff003c;
            --gold: #ffcc00;
            --bg: #050505;
        }

        body {
            background-color: var(--bg);
            color: var(--neon);
            font-family: 'Orbitron', sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        /* Scanline CRT Effect */
        body::before {
            content: " ";
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 4px, 3px 100%;
            pointer-events: none;
            z-index: 100;
        }

        #game-wrapper {
            position: relative;
            padding: 20px;
            border: 4px solid var(--neon);
            box-shadow: 0 0 20px var(--neon), inset 0 0 20px var(--neon);
            background: #000;
        }

        canvas { display: block; image-rendering: pixelated; }

        .ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.9);
            text-align: center;
            z-index: 10;
        }

        .hidden { display: none !important; }

        h1 { font-size: 3rem; text-shadow: 0 0 20px var(--neon); margin: 0; }
        h2 { color: var(--gold); text-shadow: 0 0 15px var(--gold); }
        p { letter-spacing: 2px; margin: 10px 0; }

        .btn {
            background: transparent;
            color: var(--neon);
            border: 2px solid var(--neon);
            padding: 15px 30px;
            font-family: 'Orbitron';
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: 0.2s;
            text-transform: uppercase;
        }

        .btn:hover {
            background: var(--neon);
            color: black;
            box-shadow: 0 0 30px var(--neon);
        }

        .stats {
            position: absolute;
            top: -50px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            font-size: 1rem;
        }

        #flash {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: white;
            opacity: 0;
            pointer-events: none;
            z-index: 5;
        }
    </style>
</head>
<body>

    <div id="shake-container">
        <div id="game-wrapper">
            <div id="flash"></div>
            <div class="stats">
                <div>SCORE: <span id="score">000</span></div>
                <div>LEVEL: <span id="level">1</span></div>
                <div>HI: <span id="highscore">000</span></div>
            </div>

            <!-- Start Screen -->
            <div id="start-screen" class="ui-layer">
                <h1>NEON SNAKE</h1>
                <p>PROTOCOL: SLITHER</p>
                <button class="btn" onclick="init()">Initialize</button>
            </div>

            <!-- Level Up Screen -->
            <div id="level-screen" class="ui-layer hidden">
                <h2 id="level-title">LEVEL 1 CLEAR</h2>
                <p>SPEED INCREASING...</p>
                <button class="btn" id="continue-btn" onclick="continueToNextLevel()">Continue</button>
                <p style="font-size: 0.8rem; opacity: 0.6;">(Or press SPACE)</p>
            </div>

            <!-- Game Over Screen -->
            <div id="death-screen" class="ui-layer hidden">
                <h1 style="color: var(--accent); text-shadow: 0 0 20px var(--accent);">CRITICAL ERROR</h1>
                <p id="final-score">SCORE: 0</p>
                <button class="btn" onclick="init()">Reboot System</button>
            </div>

            <canvas id="game" width="400" height="400"></canvas>
        </div>
    </div>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const highscoreEl = document.getElementById('highscore');
    const levelEl = document.getElementById('level');
    const flashEl = document.getElementById('flash');
    
    const startScreen = document.getElementById('start-screen');
    const levelScreen = document.getElementById('level-screen');
    const deathScreen = document.getElementById('death-screen');

    const GRID = 20;
    const ROWS = canvas.height / GRID;
    const COLS = canvas.width / GRID;

    let snake, apple, particles, score, level, gameLoop, velocity, running, isPaused;
    let highScore = localStorage.getItem('ultraSnakeHi') || 0;
    highscoreEl.innerText = String(highScore).padStart(3, '0');

    // Audio Context
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(freq, type, duration, volume = 0.1) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(volume, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + duration);
    }

    function init() {
        snake = { x: 10, y: 10, dx: 1, dy: 0, body: [{x:10, y:10}, {x:9, y:10}, {x:8, y:10}], length: 3 };
        apple = { x: 15, y: 15 };
        particles = [];
        score = 0;
        level = 1;
        velocity = 120;
        running = true;
        isPaused = false;

        startScreen.classList.add('hidden');
        deathScreen.classList.add('hidden');
        levelScreen.classList.add('hidden');
        
        scoreEl.innerText = "000";
        levelEl.innerText = "1";
        
        if(gameLoop) clearTimeout(gameLoop);
        main();
        playSound(440, 'square', 0.1);
    }

    function continueToNextLevel() {
        levelScreen.classList.add('hidden');
        isPaused = false;
        main(); // Restart loop
        playSound(523.25, 'square', 0.1); // C5
    }

    window.onkeydown = e => {
        if(e.code === "Space" && isPaused) continueToNextLevel();

        const dir = e.key;
        if(dir === 'ArrowUp' && snake.dy === 0) { snake.dx = 0; snake.dy = -1; }
        if(dir === 'ArrowDown' && snake.dy === 0) { snake.dx = 0; snake.dy = 1; }
        if(dir === 'ArrowLeft' && snake.dx === 0) { snake.dx = -1; snake.dy = 0; }
        if(dir === 'ArrowRight' && snake.dx === 0) { snake.dx = 1; snake.dy = 0; }
    };

    function triggerLevelUp() {
        isPaused = true;
        document.getElementById('level-title').innerText = `LEVEL ${level} COMPLETE`;
        levelScreen.classList.remove('hidden');
        
        // Level Up Sound Fanfare
        playSound(523, 'sine', 0.3);
        setTimeout(() => playSound(659, 'sine', 0.3), 150);
        setTimeout(() => playSound(783, 'sine', 0.5), 300);

        // Flash Effect
        flashEl.style.opacity = "0.8";
        setTimeout(() => flashEl.style.opacity = "0", 200);

        level++;
        velocity = Math.max(40, velocity - 15);
        levelEl.innerText = level;
    }

    function update() {
        if(isPaused) return;

        const head = { x: snake.x + snake.dx, y: snake.y + snake.dy };

        if(head.x < 0) head.x = COLS-1;
        else if(head.x >= COLS) head.x = 0;
        if(head.y < 0) head.y = ROWS-1;
        else if(head.y >= ROWS) head.y = 0;

        for(let i=0; i < snake.body.length; i++) {
            if(snake.body[i].x === head.x && snake.body[i].y === head.y) return gameOver();
        }

        snake.x = head.x;
        snake.y = head.y;
        snake.body.unshift({x: head.x, y: head.y});

        if(head.x === apple.x && head.y === apple.y) {
            score += 10;
            scoreEl.innerText = String(score).padStart(3, '0');
            playSound(660, 'sine', 0.1);
            createExplosion(apple.x, apple.y, '#00ff41');
            
            // Re-spawn apple
            apple.x = Math.floor(Math.random() * COLS);
            apple.y = Math.floor(Math.random() * ROWS);

            // Check for Level Up (Every 50 points)
            if(score > 0 && score % 50 === 0) {
                triggerLevelUp();
            }
        } else {
            snake.body.pop();
        }

        particles.forEach((p, i) => {
            p.x += p.vx; p.y += p.vy; p.life -= 0.02;
            if(p.life <= 0) particles.splice(i, 1);
        });
    }

    function createExplosion(x, y, color) {
        for(let i=0; i<12; i++) {
            particles.push({
                x: x * GRID + GRID/2, y: y * GRID + GRID/2,
                vx: (Math.random() - 0.5) * 8, vy: (Math.random() - 0.5) * 8,
                life: 1.0, color: color
            });
        }
    }

    function draw() {
        ctx.fillStyle = 'rgba(0, 0, 0, 0.4)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Apple
        ctx.shadowBlur = 15;
        ctx.shadowColor = varHex('--accent');
        ctx.fillStyle = varHex('--accent');
        ctx.fillRect(apple.x * GRID + 2, apple.y * GRID + 2, GRID - 4, GRID - 4);

        // Snake
        snake.body.forEach((part, i) => {
            ctx.shadowBlur = 10;
            ctx.shadowColor = varHex('--neon');
            ctx.fillStyle = i === 0 ? '#fff' : `rgba(0, 255, 65, ${1 - i/snake.body.length})`;
            ctx.fillRect(part.x * GRID + 1, part.y * GRID + 1, GRID - 2, GRID - 2);
        });

        // Particles
        ctx.shadowBlur = 0;
        particles.forEach(p => {
            ctx.fillStyle = `rgba(0, 255, 65, ${p.life})`;
            ctx.fillRect(p.x, p.y, 2, 2);
        });
    }

    function varHex(name) {
        return name === '--neon' ? '#00ff41' : '#ff003c';
    }

    function main() {
        if(!running || isPaused) return;
        update();
        draw();
        gameLoop = setTimeout(main, velocity);
    }

    function gameOver() {
        running = false;
        playSound(100, 'sawtooth', 0.4);
        if(score > highScore) {
            highScore = score;
            localStorage.setItem('ultraSnakeHi', highScore);
            highscoreEl.innerText = String(highScore).padStart(3, '0');
        }
        document.getElementById('final-score').innerText = `SCORE: ${score}`;
        deathScreen.classList.remove('hidden');
    }
</script>
</body>
</html>
