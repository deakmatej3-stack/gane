<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNAKE NEON ULTRA</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');

        :root {
            --neon: #00ff41;
            --accent: #ff003c;
            --bg: #050505;
        }

        body {
            background-color: var(--bg);
            color: var(--neon);
            font-family: 'Orbitron', sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        /* Scanline Effect */
        body::before {
            content: " ";
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 4px, 3px 100%;
            pointer-events: none;
            z-index: 100;
        }

        #game-wrapper {
            position: relative;
            padding: 20px;
            border: 4px solid var(--neon);
            box-shadow: 0 0 20px var(--neon), inset 0 0 20px var(--neon);
            background: #000;
        }

        canvas {
            display: block;
            image-rendering: pixelated;
        }

        .ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.8);
            text-align: center;
            transition: 0.3s;
        }

        .hidden { display: none !important; }

        h1 { font-size: 3rem; text-shadow: 0 0 20px var(--neon); margin: 0; }
        p { letter-spacing: 2px; }

        .btn {
            background: transparent;
            color: var(--neon);
            border: 2px solid var(--neon);
            padding: 15px 30px;
            font-family: 'Orbitron';
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: 0.2s;
            text-transform: uppercase;
        }

        .btn:hover {
            background: var(--neon);
            color: black;
            box-shadow: 0 0 30px var(--neon);
        }

        .stats {
            position: absolute;
            top: -50px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            font-size: 1rem;
        }

        #shake-container { transition: transform 0.1s; }
    </style>
</head>
<body>

    <div id="shake-container">
        <div id="game-wrapper">
            <div class="stats">
                <div>SCORE: <span id="score">000</span></div>
                <div>LVL: <span id="level">1</span></div>
                <div>HI: <span id="highscore">000</span></div>
            </div>

            <!-- Start Screen -->
            <div id="start-screen" class="ui-layer">
                <h1>NEON SNAKE</h1>
                <p>PROTOCOL: SLITHER</p>
                <button class="btn" onclick="init()">Initialize</button>
            </div>

            <!-- Game Over Screen -->
            <div id="death-screen" class="ui-layer hidden">
                <h1 style="color: var(--accent); text-shadow: 0 0 20px var(--accent);">CRITICAL ERROR</h1>
                <p id="final-score">SCORE: 0</p>
                <button class="btn" onclick="init()">Reboot System</button>
            </div>

            <canvas id="game" width="400" height="400"></canvas>
        </div>
    </div>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const highscoreEl = document.getElementById('highscore');
    const levelEl = document.getElementById('level');
    const shakeCont = document.getElementById('shake-container');

    // Game Constants
    const GRID = 20;
    const ROWS = canvas.height / GRID;
    const COLS = canvas.width / GRID;

    // Game Variables
    let snake, apple, particles, score, level, gameLoop, velocity, lastTime, running;
    let highScore = localStorage.getItem('ultraSnakeHi') || 0;
    highscoreEl.innerText = String(highScore).padStart(3, '0');

    // Audio Context (Synthesizer)
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(freq, type, duration) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + duration);
    }

    function init() {
        // Reset Logic
        snake = { x: 10, y: 10, dx: 1, dy: 0, body: [{x:10, y:10}, {x:9, y:10}, {x:8, y:10}], length: 3 };
        apple = { x: 15, y: 15 };
        particles = [];
        score = 0;
        level = 1;
        velocity = 120; // ms per move
        running = true;

        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('death-screen').classList.add('hidden');
        
        if(gameLoop) clearTimeout(gameLoop);
        main();
        playSound(440, 'square', 0.1);
    }

    // Input Handling
    window.onkeydown = e => {
        const dir = e.key;
        if(dir === 'ArrowUp' && snake.dy === 0) { snake.dx = 0; snake.dy = -1; }
        if(dir === 'ArrowDown' && snake.dy === 0) { snake.dx = 0; snake.dy = 1; }
        if(dir === 'ArrowLeft' && snake.dx === 0) { snake.dx = -1; snake.dy = 0; }
        if(dir === 'ArrowRight' && snake.dx === 0) { snake.dx = 1; snake.dy = 0; }
    };

    function spawnApple() {
        apple.x = Math.floor(Math.random() * COLS);
        apple.y = Math.floor(Math.random() * ROWS);
        // Don't spawn on snake body
        snake.body.forEach(part => {
            if(part.x === apple.x && part.y === apple.y) spawnApple();
        });
    }

    function createExplosion(x, y, color) {
        for(let i=0; i<10; i++) {
            particles.push({
                x: x * GRID + GRID/2,
                y: y * GRID + GRID/2,
                vx: (Math.random() - 0.5) * 6,
                vy: (Math.random() - 0.5) * 6,
                life: 1.0,
                color: color
            });
        }
    }

    function update() {
        // Move Head
        const head = { x: snake.x + snake.dx, y: snake.y + snake.dy };

        // Wall Warp
        if(head.x < 0) head.x = COLS-1;
        if(head.x >= COLS) head.x = 0;
        if(head.y < 0) head.y = ROWS-1;
        if(head.y >= ROWS) head.y = 0;

        // Self Collision
        snake.body.forEach(part => {
            if(part.x === head.x && part.y === head.y) gameOver();
        });

        if(!running) return;

        snake.x = head.x;
        snake.y = head.y;
        snake.body.unshift({x: head.x, y: head.y});

        // Eat Apple
        if(head.x === apple.x && head.y === apple.y) {
            score += 10;
            playSound(660, 'sine', 0.1);
            setTimeout(() => playSound(880, 'sine', 0.1), 50);
            createExplosion(apple.x, apple.y, '#00ff41');
            spawnApple();
            if(score % 50 === 0) {
                level++;
                velocity = Math.max(50, velocity - 10);
            }
            scoreEl.innerText = String(score).padStart(3, '0');
            levelEl.innerText = level;
        } else {
            snake.body.pop();
        }

        // Particle Physics
        particles.forEach((p, i) => {
            p.x += p.vx;
            p.y += p.vy;
            p.life -= 0.02;
            if(p.life <= 0) particles.splice(i, 1);
        });
    }

    function draw() {
        // Background with motion blur
        ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Draw Apple
        ctx.shadowBlur = 15;
        ctx.shadowColor = '#ff003c';
        ctx.fillStyle = '#ff003c';
        ctx.fillRect(apple.x * GRID + 2, apple.y * GRID + 2, GRID - 4, GRID - 4);

        // Draw Snake
        snake.body.forEach((part, i) => {
            const alpha = 1 - (i / snake.body.length * 0.8);
            ctx.shadowBlur = 10;
            ctx.shadowColor = '#00ff41';
            ctx.fillStyle = `rgba(0, 255, 65, ${alpha})`;
            ctx.fillRect(part.x * GRID + 1, part.y * GRID + 1, GRID - 2, GRID - 2);
        });

        // Draw Particles
        particles.forEach(p => {
            ctx.fillStyle = `rgba(0, 255, 65, ${p.life})`;
            ctx.fillRect(p.x, p.y, 2, 2);
        });
    }

    function main() {
        if(!running) return;
        update();
        draw();
        gameLoop = setTimeout(main, velocity);
    }

    function gameOver() {
        running = false;
        playSound(150, 'sawtooth', 0.5);
        shakeCont.style.transform = "translate(5px, 5px)";
        setTimeout(() => shakeCont.style.transform = "translate(-5px, -5px)", 50);
        setTimeout(() => shakeCont.style.transform = "translate(0, 0)", 100);

        if(score > highScore) {
            highScore = score;
            localStorage.setItem('ultraSnakeHi', highScore);
            highscoreEl.innerText = String(highScore).padStart(3, '0');
        }

        document.getElementById('final-score').innerText = `SCORE: ${score}`;
        document.getElementById('death-screen').classList.remove('hidden');
    }
</script>
</body>
</html>
